const fs = require('fs');
const users_json = "./users.json"

function jsonReader(filePath, cb) {
    fs.readFile(filePath, (err, fileData) => {
      if (err) {
        return cb && cb(err);
      }
      try {
        const object = JSON.parse(fileData);
        return cb && cb(null, object);
      } catch (err) {
        return cb && cb(err);
      }
    });
  }

  jsonReader(users_json, (err, users) => {
    if (err) {
      console.log(err);
      return;
    }
    console.log(users); // => "Infinity Loop Drive"
    var id = users.length+1;
    var new_root = {
        "id":id,
        "username":"root3",
        "password":"root3",
        "room_id":1,
        "pos_x":0
    }
    users.push(new_root);
    var  json_str = JSON.stringify(users,null,2 );
    fs.writeFile(users_json, json_str, err => {
        if (err) {
            console.log('Error writing file', err)
        } else {
            console.log('Successfully wrote file')
        }
    });
  });